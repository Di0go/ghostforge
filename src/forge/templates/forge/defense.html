{% extends 'forge/base.html' %}
{% block content %}
<div class="row">
    <div class="col-md-5">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">üõ°Ô∏è Document Scanner</h5>
            </div>
            <div class="card-body d-flex flex-column justify-content-center align-items-center">
                <form method="post" enctype="multipart/form-data" class="w-100">
                    {% csrf_token %}
                    
                    <div class="upload-box mb-4 p-5 text-center border rounded-3 bg-light" style="border: 2px dashed #0d6efd;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" class="bi bi-cloud-arrow-up text-primary mb-3" viewBox="0 0 16 16">
                            <path fill-rule="evenodd" d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"/>
                            <path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383z"/>
                        </svg>
                        <h6 class="fw-bold text-muted">Drag & Drop PDF here</h6>
                        <small class="text-secondary">or click to browse files</small>
                        
                        <div class="mt-3">
                            {{ form.input_file }}
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 py-2 fw-bold">
                        Analyze Risk
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="col-md-7">
        {% if result %}
        <div class="card border-{{ result.risk_level|lower }} shadow mb-4">
            <div class="card-header d-flex justify-content-between align-items-center bg-white">
                <h5 class="mb-0">Analysis Results</h5>
                <span class="badge rounded-pill bg-{{ result.risk_level|lower }} fs-6">
                    RISK: {{ result.risk_level }} ({{ result.risk_score }}/100)
                </span>
            </div>
            <div class="card-body">
                <h6 class="text-muted">AI Report:</h6>
                <div class="alert alert-light border">
                    {{ result.analysis_report|linebreaks }}
                </div>
                
                <hr>
                
                <p>
                    <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#rawContent">
                        Show Extracted Text
                    </button>
                </p>
                <div class="collapse" id="rawContent">
                    <div class="card card-body bg-light small">
                        <pre style="white-space: pre-wrap;">{{ result.content_extracted }}</pre>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <h5 class="text-muted mt-4">Recent Scans</h5>
        <div class="list-group">
            {% for item in history %}
            <div class="list-group-item d-flex justify-content-between align-items-center">
                <div style="max-width: 70%;">
                    <div class="fw-bold text-truncate">{{ item.file_name }}</div>
                    <small class="text-muted">{{ item.analyzed_at|date:"H:i d/M" }}</small>
                </div>
                <span class="badge bg-{{ item.risk_level|lower }}">{{ item.risk_level }}</span>
            </div>
            {% empty %}
            <div class="list-group-item text-muted text-center py-3">
                No recent files analyzed.
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<style>
    .bg-critical { background-color: #dc3545 !important; color: white; }
    .bg-high { background-color: #fd7e14 !important; color: white; }
    .bg-medium { background-color: #ffc107 !important; color: black; }
    .bg-low { background-color: #198754 !important; color: white; }
    
    .border-critical { border-color: #dc3545; }
    .border-high { border-color: #fd7e14; }
    .border-medium { border-color: #ffc107; }
    .border-low { border-color: #198754; }

    input[type=file] {
        width: 100%;
        color: transparent;
    }
    input[type=file]::file-selector-button {
        margin-right: 20px;
        border: none;
        background: #0d6efd;
        padding: 10px 20px;
        border-radius: 5px;
        color: #fff;
        cursor: pointer;
        transition: background .2s ease-in-out;
    }
    input[type=file]::file-selector-button:hover {
        background: #0b5ed7;
    }
</style>
{% endblock %}